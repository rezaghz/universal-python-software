var m_cjEf,m_elmCv,m_ctxCv,m_elmEf,m_iLastTimer,m_iPatternTempoMin,m_iPatternTempoCnt,m_iTempoStartSec,m_iEdi=1,iKeta=2,m_sParticleMarge={bgColor:"#ffffff",width:0,height:0,emitFrequency:0,startX:0,startXVariance:0,startY:0,startYVariance:0,initialDirection:0,initialDirectionVariance:30,initialSpeed:5,initialSpeedVariance:5,friction:.01,accelerationSpeed:.1*Math.random(),accelerationDirection:Math.floor(360*Math.random()),startScale:0,startScaleVariance:0,finishScale:0,finishScaleVariance:0,lifeSpan:40,lifeSpanVariance:80,startAlpha:1,startAlphaVariance:0,finishAlpha:0,finishAlphaVariance:1,shapeIdList:["kirakira"],startColor:{hue:0,hueVariance:0,luminance:75,luminanceVariance:10,saturation:80,saturationVariance:10},alphaCurveType:1,blendMode:!0,VERSION:"1.0.0"},m_aptMain=[],m_sTool={strColor:"rgba(0,0,0,1)",iLineWidth:3,bDraw:!1,iLastMouseX:0,iLastMouseY:0,iStopMouseX:0,iStopMouseY:0,iStartTimer:0},m_iLoopMsec=25,m_aasLine=[],m_aasBezier=[],m_aasPeni=[],m_aiTempo=[0],m_aiPatternTempo=[],m_aiTempoAdjust=[],m_iTempoScore=-1,m_strAnni="",m_aiShiruKoma=[],m_aasShiru=[],m_iFrameCnt=100,m_iFrameIdx=0,m_bStop=!1;$(function(){for(var e=location.hostname,a=0,i=0;i<e.length;i++)a+=e.charCodeAt(i);switch(new URL(window.location.href),e=(a=new Date).getMonth()+1,""+e+"/"+(a=a.getDate())){case"12/24":case"12/25":m_strAnni="xmas"}clsAds.fnInit(),m_iWw=clsAds.iWw,m_iWh=clsAds.iWh-120-clsAds.iAdsTail-clsAds.iAdsHead,$("#grp").width(m_iWw),$("#grp").height(m_iWh),m_ctxCv=(m_elmCv=document.getElementById("elmCv")).getContext("2d"),m_elmCv.width=m_iWw,m_elmCv.height=m_iWh,m_iEdi=Number($("#txt_edi").val()),clsAds.fnStart(function(){m_iWh=clsAds.iWh-120-clsAds.iAdsTail,$("#grp").height(m_iWh),m_elmCv.height=m_iWh,(m_elmEf=document.getElementById("elmEf")).width=m_iWw,m_elmEf.height=m_iWh,$("#grp").css("background-color","#ffffff"),m_cjEf=new createjs.Stage("elmEf"),createjs.Ticker.framerate=60,createjs.Ticker.timingMode=createjs.Ticker.RAF,createjs.Ticker.addEventListener("tick",fnLoopEffect),m_elmCv.addEventListener("mouseup",fnTouch,!0),m_elmCv.addEventListener("mousedown",fnTouch,!0),m_elmCv.addEventListener("mousemove",fnTouch,!0),m_elmCv.addEventListener("touchstart",fnTouch,!0),m_elmCv.addEventListener("touchend",fnTouch,!0),m_elmCv.addEventListener("touchmove",fnTouch,!0),m_ctxCv.lineJoin="round",m_ctxCv.lineCap="round",fnLoop()},-5,m_elmCv),m_ctxCv.strokeStyle=m_sTool.strColor,m_ctxCv.lineWidth=m_sTool.iLineWidth,m_ctxCv.lineJoin="round",m_ctxCv.lineCap="round",m_aasPeni=fnConvShapeXY2ShapeRA(m_aasPeni=fnAdjustShapeScale(m_aasPeni=fnConvSvg2ShapeArray(["M 5.3015862,316.06351 L 6.8790705,315.94405 L 8.276245,315.61491 L 9.4064476,314.99875 L 10.183016,314.01821 L 10.519287,312.59595 L 10.411068,311.36658 L 9.9935461,310.19443 L 9.3225443,309.12052 L 8.4538862,308.18589 L 7.4433954,307.43158 L 6.3468952,306.89862 L 5.2202092,306.62805 L 4.1191607,306.66095 L 4.1446877,305.52033 L 4.1977897,304.41962 L 4.2706667,303.33369 L 4.3555197,302.23738 L 4.4445467,301.10556 L 4.5299477,299.91307 L 4.6039227,298.63477 L 4.6586717,297.24551 L 4.3166654,294.7536 L 3.2783257,292.9901 L 1.7762259,291.94679 L 0.04293936,291.61546 L -1.6889605,291.98788 L -3.1869003,293.05585 L -4.2183067,294.81113 L -4.5506063,297.24551 L -4.4939143,298.67591 L -4.4272033,300.01792 L -4.3539473,301.27952 L -4.2776213,302.46871 L -4.2016983,303.5935 L -4.1296533,304.66187 L -4.0649603,305.68184 L -4.0110943,306.66139 L -5.1925955,306.63759 L -6.3793674,306.86162 L -7.5142675,307.31893 L -8.5401533,307.99497 L -9.3998822,308.87522 L -10.036312,309.94515 L -10.3923,311.19021 L -10.4107,312.59588 L -9.9444273,314.08651 L -9.0195717,315.09065 L -7.7417655,315.69801 L -6.2166415,315.9983 L -4.5498321,316.0812","M 5.3269686,316.06351 C 13.640782,315.94706 11.09505,307.35519 4.1445431,306.66095 C 4.0683921,302.22488 6.9379602,291.61546 0.068321837,291.61546 C -6.8013166,291.61546 -4.2324029,302.04252 -3.9857119,306.66139 C -11.585308,306.95811 -13.689786,315.52737 -4.5244497,316.0812",]))),window.DeviceOrientationEvent&&(DeviceOrientationEvent.requestPermission?(fnInitGyro(),$("#btn_reset").before('<a id="btn_gyro" class="btn" style="background-color: #00aad4;" href="#" onclick="fnInitGyro(); return false;">Shake Mode</a>\n')):window.addEventListener("devicemotion",fnDevicemotion)),document.getElementById("btn_stop").addEventListener("click",function(e){(m_bStop=!m_bStop)?document.getElementById("btn_stop").innerHTML="Restart":document.getElementById("btn_stop").innerHTML="Stop",e.preventDefault()},!1)});var m_iShake={iLocX:0,iLocY:0,iVecX:0,iVecY:0,iStartTimer:0};function fnShakeWindow(e,a){if(m_iShake.iLocX!=e||m_iShake.iLocY!=a){var i=m_iShake.iVecX,n=m_iShake.iVecY;if(e>m_iShake.iLocX&&(i=1),e<m_iShake.iLocX&&(i=-1),a>m_iShake.iLocY&&(n=1),a<m_iShake.iLocY&&(n=-1),m_iShake.iVecX!=i||m_iShake.iVecY!=n){if(500>new Date().getTime()-m_iShake.iStartTimer)for(var r=0,t=m_aasLine.length;r<t;r++)2<=m_aasLine[r].iMorphPer&&(m_aasBezier[r].iPuruPerMax+=.1*Math.random(),m_aasBezier[r].iPuruPerMax=Math.min(1,m_aasBezier[r].iPuruPerMax),m_aasBezier[r].iPuruPerVec+=.05*Math.random()*(0<=m_aasBezier[r].iPuruPerVec?1:-1),m_aasBezier[r].iPuruPerVec=Math.min(1,m_aasBezier[r].iPuruPerVec),m_aasBezier[r].iPuruPerVec=Math.max(-1,m_aasBezier[r].iPuruPerVec),m_aiShiruKoma[r]+=100,m_aiShiruKoma[r]=Math.min(m_aiShiruKoma[r],1e4));m_iShake.iStartTimer=new Date().getTime(),fnEndTempo()}m_iShake.iLocX=e,m_iShake.iLocY=a,m_iShake.iVecX=i,m_iShake.iVecY=n}}function fnDevicemotion(e){var a=e.acceleration.x;e=e.acceleration.y,(5<a||-5>a||5<e||-5>e)&&fnShakeWindow(a,e)}function fnLoopEffect(){for(var e=0,a=m_aptMain.length;e<a;e++)m_aptMain[e].startColor.hue=m_aasLine[e].hue,m_aptMain[e].startColor.hueVariance=m_aasLine[e].hueVariance,m_aptMain[e].startColor.saturation=m_aasLine[e].saturation,m_aptMain[e].startColor.saturationVariance=m_aasLine[e].saturationVariance,m_aptMain[e].startColor.luminance=m_aasLine[e].luminance,m_aptMain[e].startColor.luminanceVariance=m_aasLine[e].luminanceVariance,m_aptMain[e].update();m_cjEf.update()}function fnFloor(e,a){return e=Math.floor(e*Math.pow(10,a))/Math.pow(10,a)}function fnTouch(e){if(e.preventDefault(),1=="ontouchend"in document&&0<e.touches.length)var a=Math.floor(e.touches[0].clientX),i=Math.floor(e.touches[0].clientY);else a=e.clientX,i=e.clientY;switch(i-=m_elmCv.getBoundingClientRect().top,e.type){case"mousedown":case"touchstart":if(m_sTool.iStartTimer=new Date().getTime(),fnDrawEnd(-.5),fnDrawStart(a,i),fnSetTempo(),0<(a=fnGetPatternTempo()).length){for(m_iPatternTempoCnt=0,m_iPatternTempoMin=(m_aiPatternTempo=a)[0],a=0;a<m_aiPatternTempo.length;a++)m_iPatternTempoCnt+=m_aiPatternTempo[a],m_iPatternTempoMin=Math.min(m_aiPatternTempo[a],m_iPatternTempoMin);for(i=0,a=[];i<m_aiPatternTempo.length;i++)e=Math.min(e=Math.round(m_aiPatternTempo[i]/m_iPatternTempoMin),8),a.push(e);i="",e=-1;for(var n=0;n<a.length;n++){for(var r=[],t=0,m=0;m<a.length;m++)r.push(a[(m+n)%a.length]),t+=(a[(m+n)%a.length]-1)*Math.pow(2,m);(-1==e||e<t)&&(i=r.join("_"),e=t)}m_aiTempoAdjust=i.split("_"),m_iTempoScore=e,console.log(m_aiTempoAdjust,m_iTempoScore),m_iTempoStartSec=new Date().getTime(),m_iTempoStartSec-=250}break;case"mouseup":case"touchend":fnDrawEnd(-.5);break;case"mousemove":case"touchmove":0!=m_sTool.bDraw&&(m_sTool.iStartTimer=new Date().getTime(),10>Math.sqrt(Math.pow(m_sTool.iLastMouseX-a,2)+Math.pow(m_sTool.iLastMouseY-i,2))||(m_sTool.iLastMouseX=a,m_sTool.iLastMouseY=i,m_aasLine[e=m_aasLine.length-1][m_aasLine[e].length]={iX:a,iY:i},fnClearTempo()))}}function fnDrawStart(e,a){1!=m_sTool.bDraw&&(m_sTool.bDraw=!0,m_sTool.iLastMouseX=e,m_sTool.iLastMouseY=a,m_aasLine[m_aasLine.length]=[])}function fnDrawEnd(e){if(0!=m_sTool.bDraw){m_sTool.bDraw=!1;var a=m_aasLine.length-1;if(2>m_aasLine[a].length)m_aasLine.pop();else{var i=fnGetXYRA(m_aasLine[a]),n=[];for(iIdx=0;iIdx<m_aasPeni.length;iIdx++)n[iIdx]=fnConvShapeRA2LineXY(m_aasPeni[iIdx],i.iX,i.iY,i.iR,i.iA+Math.PI/180*90);m_aasLine[a].length>n[0].length?n[0]=fnAdjustShapePointCount(n[0],m_aasLine[a].length):m_aasLine[a].length<n[0].length&&(m_aasLine[a]=fnAdjustShapePointCount(m_aasLine[a],n[0].length)),fnIsReverse(m_aasLine[a],n[0])&&(n[0]=fnReverseShape(n[0]));for(var r=0,t=m_aasLine[a].length;r<t;r++)m_aasLine[a][r].iOldX=m_aasLine[a][r].iX,m_aasLine[a][r].iOldY=m_aasLine[a][r].iY,m_aasLine[a][r].iNewX=n[0][r].iX,m_aasLine[a][r].iNewY=n[0][r].iY;for(m_aasBezier[a]=n[1],m_aasBezier[a].iPuruPerIdx=0,m_aasBezier[a].iPuruPerMax=0,m_aasBezier[a].iPuruPerVec=0,m_aasBezier[a].iPuruCenterPer=2*Math.random(),m_aasBezier[a].iPuruPuruSt=Math.floor(4*Math.random())+2,m_aiShiruKoma[a]=0,m_aasShiru[a]=[],m_aasShiru[a].aiX=[],m_aasShiru[a].aiY=[],n=0,r=m_aasBezier[a].length;n<r;n++)m_aasShiru[a].aiX[n]=m_aasBezier[a][n].iX,m_aasShiru[a].aiY[n]=m_aasBezier[a][n].iY;m_aasShiru[a].iR=i.iR,m_aasLine[a].iMorphPer=e,m_aptMain[a]=new particlejs.ParticleSystem,m_sParticleMarge.width=m_iWw,m_sParticleMarge.height=m_iWh,m_aptMain[a].importFromJson(m_sParticleMarge),m_cjEf.addChild(m_aptMain[a].container),m_aasLine[a].iR=i.iR,m_aasLine[a].strState=""}}}function fnLoop(){var e=-1;if(new Date().getTime()>=m_iTempoStartSec)for(var a=(new Date().getTime()-m_iTempoStartSec)%m_iPatternTempoCnt,i=0,n=0;n<m_aiPatternTempo.length;n++){if(a>=i&&a<i+m_aiPatternTempo[n]){e=Math.min(1,e=(a-i)/m_iPatternTempoMin);break}i+=m_aiPatternTempo[n]}for(fnShakeWindow(Math.floor((window.screenX||window.screenLeft||0)/10),Math.floor((window.screenY||window.screenTop||0)/10)),m_sTool.bDraw&&m_sTool.iStopMouseX==m_sTool.iLastMouseX&&m_sTool.iStopMouseY==m_sTool.iLastMouseY&&3e3<new Date().getTime()-m_sTool.iStartTimer&&(fnDrawEnd(0),fnDrawStart(m_sTool.iLastMouseX,m_sTool.iLastMouseY)),m_sTool.iStopMouseX=m_sTool.iLastMouseX,m_sTool.iStopMouseY=m_sTool.iLastMouseY,a=0,i=m_aasLine.length;a<i;a++)2<=m_aasLine[a].length&&(m_bStop?0<=m_aasLine[a].iMorphPer&&(m_aasLine[a].iMorphPer-=m_iLoopMsec/25*.1):2>=m_aasLine[a].iMorphPer&&(m_aasLine[a].iMorphPer+=m_iLoopMsec/25*.01));for(m_ctxCv.clearRect(0,0,m_elmCv.width,m_elmCv.height),a=0,i=m_aasLine.length;a<i;a++){if(0<=(n=m_aasLine[a].iMorphPer)&&1>=n){var r=n;r=(Math.cos((1-(r=Math.min(1,r=Math.max(0,r))))*Math.PI)+1)/2,m_aasLine[a]=fnMorph(m_aasLine[a],"iX","iOldX","iNewX",r),m_aasLine[a]=fnMorph(m_aasLine[a],"iY","iOldY","iNewY",r)}if(1<=n&&2>=n&&(r=Math.min(1,r=Math.max(0,r=2-n)),m_ctxCv.globalAlpha=r),(!n||2>=n)&&fnDrawLine(m_ctxCv,m_aasLine[a]),1<=n&&2>=n&&(r=Math.min(1,r=Math.max(0,r=n-1)),m_ctxCv.globalAlpha=r),1<=n){r=[];for(var t=0;t<m_aasBezier[a].length;t++)r[t]=[],r[t].iX=m_aasBezier[a][t].iX,r[t].iY=m_aasBezier[a][t].iY;if(2<=n&&0<=e){t=(r[0].iX+r[12].iX)/2;var m=(r[0].iY+r[12].iY)/2,o=e;o+=(o+0*a)%1,o=fnConvRhythmPer(o,a);for(var s=3;9>=s;s++)r[s].iX+=-(.2*(t-r[s].iX)*o),r[s].iY+=-(.2*(m-r[s].iY)*o);0==m_aasBezier[a].iPuruPerMax&&(m_aasBezier[a].iPuruPerMax=.5*Math.random(),m_aasBezier[a].iPuruPerVec=.02*Math.random()),m_aasBezier[a].iPuruPerIdx+=m_aasBezier[a].iPuruPerVec,(0>m_aasBezier[a].iPuruPerVec&&m_aasBezier[a].iPuruPerIdx<0-m_aasBezier[a].iPuruPerMax||0<m_aasBezier[a].iPuruPerVec&&m_aasBezier[a].iPuruPerIdx>m_aasBezier[a].iPuruPerMax)&&(m_aasBezier[a].iPuruPerVec*=-1)}else 0!=m_aasBezier[a].iPuruPerMax&&(m_aasBezier[a].iPuruPerIdx+=m_aasBezier[a].iPuruPerVec,(0>m_aasBezier[a].iPuruPerVec&&m_aasBezier[a].iPuruPerIdx<0-m_aasBezier[a].iPuruPerMax||0<m_aasBezier[a].iPuruPerVec&&m_aasBezier[a].iPuruPerIdx>m_aasBezier[a].iPuruPerMax)&&(m_aasBezier[a].iPuruPerMax*=.95,m_aasBezier[a].iPuruPerVec*=-.95),-.01<m_aasBezier[a].iPuruPerMax&&.01>m_aasBezier[a].iPuruPerMax&&(m_aasBezier[a].iPuruPerIdx=0,m_aasBezier[a].iPuruPerMax=0));if(0!=m_aasBezier[a].iPuruPerIdx){t=(r[0].iX+r[12].iX)/2,m=(r[0].iY+r[12].iY)/2,t+=((r[3].iX+r[9].iX)/2-t)*m_aasBezier[a].iPuruCenterPer,m+=((r[3].iY+r[9].iY)/2-m)*m_aasBezier[a].iPuruCenterPer,o=m_aasBezier[a].iPuruPerIdx,s=12-m_aasBezier[a].iPuruPuruSt;for(var u=m_aasBezier[a].iPuruPuruSt;u<=s;u++)r[u]=fnRotate(t,m,r[u].iX,r[u].iY,40*o)}if(.8<e){if(o=r[3].iX,s=r[3].iY,t=r[6].iX,o=Math.atan2((m=r[6].iY)-(s+.5*(r[9].iY-s)),t-(o+.5*(r[9].iX-o)))/(Math.PI/180),m_aptMain[a].startX=t,m_aptMain[a].startY=m,""==m_aasLine[a].strState)for(t=0,m=m_aasLine.length;t<m;t++)void 0!=m_aptMain[t]&&t!=a&&m_aptMain[a].startX>=m_aptMain[t].startX-20&&m_aptMain[a].startX<=m_aptMain[t].startX+20&&m_aptMain[a].startY>=m_aptMain[t].startY-20&&m_aptMain[a].startY<=m_aptMain[t].startY+20&&(m_aasLine[a].strState="love");m_aptMain[a].initialDirection=o,"love"==m_aasLine[a].strState?(m_aptMain[a].initialDirectionVariance=180,m_aptMain[a].initialSpeed=1,m_aptMain[a].initialSpeedVariance=1,m_aptMain[a].friction=.01,m_aptMain[a].accelerationSpeed=.01,m_aptMain[a].accelerationDirection=270,m_aptMain[a].lifeSpan=80,m_aptMain[a].lifeSpanVariance=80,m_aptMain[a].shapeIdList=["heart"],m_aasLine[a].hue=0,m_aasLine[a].hueVariance=20,m_aasLine[a].luminance=60,m_aasLine[a].luminanceVariance=20,m_aasLine[a].saturation=90,m_aasLine[a].saturationVariance=10,m_aptMain[a].alphaCurveType=0,m_aptMain[a].startScale=.005*m_aasLine[a].iR,m_aptMain[a].emitFrequency=10):(t=["circle","kirakira"],m_aptMain[a].shapeIdList=[t[m_aiTempoAdjust.length%t.length]],m_aasLine[a].hue=157*m_iTempoScore%180,m_aasLine[a].hueVariance=10*m_aiTempoAdjust.length%360,m_aasLine[a].luminance=75,m_aasLine[a].luminanceVariance=10,m_aasLine[a].saturation=80,m_aasLine[a].saturationVariance=10,m_aptMain[a].startScale=.004*m_aasLine[a].iR,m_aptMain[a].emitFrequency=50,0==m_iTempoScore?(m_aptMain[a].shapeIdList=["circle"],m_aasLine[a].hue=0,m_aasLine[a].hueVariance=10*m_aiTempoAdjust.length%360,m_aasLine[a].luminance=75,m_aasLine[a].luminanceVariance=20,m_aasLine[a].saturation=0,m_aasLine[a].saturationVariance=20):4==m_iTempoScore||36==m_iTempoScore||292==m_iTempoScore?(m_aptMain[a].shapeIdList=["star"],m_aasLine[a].hue=60,m_aasLine[a].hueVariance=30):4672==m_iTempoScore&&(m_aptMain[a].shapeIdList=["star"],m_aasLine[a].hue=0,m_aasLine[a].hueVariance=360))}else m_aptMain[a].emitFrequency=0;fnDrawBezier(m_ctxCv,r)}1<=n&&2>=n&&(m_ctxCv.globalAlpha=1)}if(!e||0>e){for(e=0,m_ctxCv.lineWidth=m_sTool.iLineWidth,iForCnt=Math.min(iForCnt=m_aasBezier.length,10);e<iForCnt;e++)1<=m_aasLine[e].iMorphPer&&0>=m_aasBezier[e].iPuruPerMax&&(a=m_aasShiru[e].aiX.length-1,clsEffect.sbDrawDew(m_ctxCv,1,m_aasShiru[e],0,"",0,"#aaaaaa",.8,1e3<m_aiShiruKoma[e],1,2,0,a/2,a,.7*m_aasShiru[e].iR,.3*m_aasShiru[e].iR,2*m_aasShiru[e].iR,10,"",m_iFrameCnt,m_iFrameIdx,"peni"+e,!1,1,0,!0,!0),0<m_aiShiruKoma[e]&&--m_aiShiruKoma[e]);m_ctxCv.globalAlpha=1}setTimeout(fnLoop,m_iLoopMsec)}function fnConvRhythmPer(e,a){var i=.3*a%.7+.3;return e<i?(e/=i,e=1-e):e=0,e}function fnClearTempo(){m_aiTempo=[0]}function fnEndTempo(){m_aiTempo=[0],m_aiPatternTempo=[]}function fnSetTempo(){var e=new Date().getTime();if(m_iLastTimer){var a=e-m_iLastTimer;1e4<a&&fnClearTempo(),m_aiTempo[m_aiTempo.length]=a,30<m_aiTempo.length&&m_aiTempo.shift()}m_iLastTimer=e}function fnGetPatternTempo(){for(var e=[],a=Math.floor((m_aiTempo.length-0)/2);1<=a;a--){var i=1>=a?4:2>=a?3:2,n=[];if(m_aiTempo.length>=a*i-1){for(var r=!0,t=m_aiTempo.length-1;t>m_aiTempo.length-a*i;t--)if(n[t]=m_aiTempo[t],t<=m_aiTempo.length-a-1){var m=n[t]>=n[t+a]-200&&n[t]<=n[t+a]+200;if(r=r&&m,0==m)break}if(r){for(e=[],a=m_aiTempo.length-a;a<m_aiTempo.length;a++)e[e.length]=m_aiTempo[a];break}}}return e}function fnGetXYRA(e){for(var a=0,i=0,n=0,r=e.length;n<r;n++)a+=e[n].iX,i+=e[n].iY;a/=e.length,i/=e.length,r=n=0;for(var t=e.length;r<t;r++)n+=Math.sqrt(Math.pow(e[r].iX-a,2)+Math.pow(e[r].iY-i,2));return{iX:a,iY:i,iR:n/e.length,iA:Math.atan2(i-(e[0].iY+(e[e.length-1].iY-e[0].iY)/2),a-(e[0].iX+(e[e.length-1].iX-e[0].iX)/2))}}function fnDrawLine(e,a){if(2<=a.length){e.beginPath();for(var i=0,n=a.length;i<n;i++){var r=a[i].iX,t=a[i].iY;0==i?e.moveTo(r,t):e.lineTo(r,t)}e.stroke()}}function fnDrawBezier(e,a){if(2<=a.length){e.beginPath(),e.moveTo(a[0].iX,a[0].iY);for(var i=1;i<a.length;i+=3)e.bezierCurveTo(a[i+0].iX,a[i+0].iY,a[i+1].iX,a[i+1].iY,a[i+2].iX,a[i+2].iY);e.stroke()}}function fnConvSvg2ShapeArray(e){var a=[];for(iShapeIdx=0;iShapeIdx<e.length;iShapeIdx++){a[iShapeIdx]=[],strShape=e[iShapeIdx];for(var i,n,r=strShape.split(" "),t=0,m=0,o=r.length;m<o;m++)2==(n=r[m].split(",")).length&&(i=Number(n[0]),n=Number(n[1]),a[iShapeIdx][t]={iX:i,iY:n},t++)}return a}function fnConvSvg2ShapeArray2(e){e=e.split(" ");for(var a=[],i=0,n=0,r=0,t=0,m=e.length;t<m;t++){var o=e[t].split(",");2==o.length&&(i+=Number(o[0]),n+=Number(o[1]),a[r]={iX:i,iY:n},r++)}return a}function fnAdjustShapeScale(e){var a=0,i=0,n=0,r=0;for(iShapeIdx=0;iShapeIdx<e.length;iShapeIdx++)for(var t=0,m=e[iShapeIdx].length;t<m;t++){var o=e[iShapeIdx][t].iX,s=e[iShapeIdx][t].iY;0==t?(a=o,i=s,n=o,r=s):(a=Math.min(o,a),i=Math.min(s,i),n=Math.max(o,n),r=Math.max(s,r))}for(n-=a,r-=i,t=2/Math.max(n,r),iShapeIdx=0;iShapeIdx<e.length;iShapeIdx++)for(m=0,o=e[iShapeIdx].length;m<o;m++)e[iShapeIdx][m].iX+=0-a-.5*n,e[iShapeIdx][m].iY+=0-i-.5*r,e[iShapeIdx][m].iX*=t,e[iShapeIdx][m].iY*=t;return e}function fnConvShapeXY2ShapeRA(e){for(iShapeIdx=0;iShapeIdx<e.length;iShapeIdx++)for(var a=0,i=e[iShapeIdx].length;a<i;a++)e[iShapeIdx][a].iA=Math.atan2(e[iShapeIdx][a].iY,e[iShapeIdx][a].iX),e[iShapeIdx][a].iR=Math.sqrt(Math.pow(e[iShapeIdx][a].iX,2)+Math.pow(e[iShapeIdx][a].iY,2));return e}function fnConvShapeRA2LineXY(e,a,i,n,r){for(var t=[],m=0,o=e.length;m<o;m++){var s=Math.cos(e[m].iA+r)*e[m].iR,u=Math.sin(e[m].iA+r)*e[m].iR;s=a+s*n,u=i+u*n,t[m]={iX:s,iY:u}}return t}function fnAdjustShapePointCount(e,a){var i=0;for(iOldIdx=0;iOldIdx<e.length-1;iOldIdx++)i+=Math.sqrt(Math.pow(e[iOldIdx+1].iX-e[iOldIdx].iX,2)+Math.pow(e[iOldIdx+1].iY-e[iOldIdx].iY,2));i/=a-1;var n=[],r=0,t=0;for(iOldIdx=0;iOldIdx<e.length-1;iOldIdx++){var m=Math.sqrt(Math.pow(e[iOldIdx+1].iX-e[iOldIdx].iX,2)+Math.pow(e[iOldIdx+1].iY-e[iOldIdx].iY,2));for(t+=m,iIdx=r;iIdx*i<t;iIdx++){var o=(iIdx-r)*i/m;n[iIdx]={iX:e[iOldIdx].iX+(e[iOldIdx+1].iX-e[iOldIdx].iX)*o,iY:e[iOldIdx].iY+(e[iOldIdx+1].iY-e[iOldIdx].iY)*o}}r=iIdx}return n[a-1]={iX:e[e.length-1].iX,iY:e[e.length-1].iY},n}function fnIsReverse(e,a){var i=e[0].iX,n=e[0].iY,r=e[e.length-1].iX,t=e[e.length-1].iY,m=a[0].iX,o=a[0].iY,s=a[a.length-1].iX,u=a[a.length-1].iY;return Math.sqrt(Math.pow(i-m,2)+Math.pow(n-o,2))+Math.sqrt(Math.pow(r-s,2)+Math.pow(t-u,2))>Math.sqrt(Math.pow(i-s,2)+Math.pow(n-u,2))+Math.sqrt(Math.pow(r-m,2)+Math.pow(t-o,2))}function fnReverseShape(e){for(var a=[],i=e.length,n=0,r=e.length;n<r;n++){var t=i-n-1;a[n]=[],a[n].iX=e[t].iX,a[n].iY=e[t].iY}return a}function fnMorph(e,a,i,n,r){for(var t=0,m=e.length;t<m;t++)e[t][a]=e[t][i]+(e[t][n]-e[t][i])*r;return e}function fnRotate(e,a,i,n,r){if(0!=r%360){var t=Math.sqrt(Math.pow(i-e,2)+Math.pow(n-a,2));n=Math.atan2(n-a,i-e)/(Math.PI/180),n+=r,i=e+Math.cos(n/180*Math.PI)*t,n=a+Math.sin(n/180*Math.PI)*t}return{iX:i,iY:n}}function fnInitGyro(){DeviceOrientationEvent.requestPermission().then(function(e){$("#btn_gyro").remove(),"granted"===e&&window.addEventListener("devicemotion",fnDevicemotion)})}